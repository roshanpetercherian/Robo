<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Control Center</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* Specific Styles for Request Buttons if not in CSS */
        .request-btn-large {
            border: none;
            border-radius: 12px;
            color: white;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 5px;
            height: 100px; /* Fixed height for consistency */
        }
        .request-btn-large:active { transform: scale(0.95); }
        .request-btn-large:hover { opacity: 0.9; transform: translateY(-2px); }
        
        /* Modal Styles */
        .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; display:flex; justify-content:center; align-items:center; }
        .modal-box { background:#2d3748; padding:20px; border-radius:12px; width:300px; border:1px solid #667eea; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="navbar-title">
            <svg class="navbar-logo" viewBox="0 0 24 24" fill="none">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="url(#grad1)"/>
                <path d="M2 17L12 22L22 17" stroke="url(#grad1)" stroke-width="2"/>
                <path d="M2 12L12 17L22 12" stroke="url(#grad1)" stroke-width="2"/>
                <defs>
                    <linearGradient id="grad1" x1="2" y1="2" x2="22" y2="22">
                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                    </linearGradient>
                </defs>
            </svg>
            Robot Control Center
        </div>
        <div class="navbar-links">
            <a href="/">Dashboard</a>
            <a href="/logs">Inventory</a>
            <a href="/map">Map</a>
            <a href="/history">History</a> 
            <a href="/logout">Logout</a>
        </div>
    </nav>

    <div class="dashboard-grid">
        
        <div class="panel">
            <h2 class="panel-title">
                <div class="panel-icon">
                    <svg viewBox="0 0 24 24" fill="white" width="16" height="16"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                </div>
                Live Digital Twin
            </h2>
            <div id="canvas-container">
                <div class="interaction-hint">Drag to Rotate â€¢ Scroll to Zoom</div>
            </div>
        </div>

        <div class="panel">
            <h2 class="panel-title">
                <div class="panel-icon">
                    <svg viewBox="0 0 24 24" fill="none" width="16" height="16" stroke="white" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                </div>
                Daily Schedule
            </h2>
            
            <div class="status-row">
                <div class="status-indicator status-online" id="statusIndicator"></div>
                <div>
                    <strong>System Status:</strong> <span id="systemStatus" style="color: #48bb78; font-weight: 600;">Online</span>
                </div>
            </div>

            <div style="flex-grow: 1; display: flex; flex-direction: column; overflow: hidden;">
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-right: 5px;">
                    <div class="schedule-header" style="margin-bottom: 0;">Today's Tasks</div>
                    <button onclick="openAddModal()" style="background: #48bb78; border: none; color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-family: inherit; font-weight: 600; font-size: 0.85rem; transition: 0.2s;">
                        + Add Task
                    </button>
                </div>

                <div class="schedule-container" id="scheduleContainer">
                    <div style="text-align: center; color: #718096; padding: 20px;">
                        Connecting to server...
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2 class="panel-title">
                <div class="panel-icon">
                    <svg viewBox="0 0 24 24" fill="white" width="16" height="16"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                </div>
                Patient Requests
            </h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                
                <button onclick="sendRequest('medicine')" class="request-btn-large" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <div style="font-size: 2rem; margin-bottom: 5px;">ðŸ’Š</div>
                    Medicine
                </button>

                <button onclick="sendRequest('water')" class="request-btn-large" style="background: linear-gradient(135deg, #4299e1, #3182ce);">
                    <div style="font-size: 2rem; margin-bottom: 5px;">ðŸ’§</div>
                    Water
                </button>

                <button onclick="sendRequest('help')" class="request-btn-large" style="background: linear-gradient(135deg, #f56565, #c53030); animation: pulse-red 2s infinite;">
                    <div style="font-size: 2rem; margin-bottom: 5px;">ðŸš¨</div>
                    HELP
                </button>
            </div>

            <div class="voice-section">
                <button class="voice-btn" id="voiceBtn">
                    <div class="mic-icon">
                        <svg viewBox="0 0 24 24" fill="none" width="20" height="20" stroke="white" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
                    </div>
                    <span id="voiceBtnText">Tap to Speak</span>
                </button>
                <div class="voice-output" id="voiceOutput">Ready for command...</div>
            </div>
        </div>

        <div class="panel">
            <h2 class="panel-title">
                <div class="panel-icon">
                    <svg viewBox="0 0 24 24" fill="none" width="16" height="16" stroke="white" stroke-width="2"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg>
                </div>
                Manual Override
            </h2>
            
            <textarea class="command-input" id="manualCommandInput" placeholder="Enter specific instruction..."></textarea>
            
            <button class="send-btn" id="sendCommandBtn">
                Send Command
            </button>

            <div class="response-area" id="responseArea">
                System idle.
            </div>
        </div>

    </div>

    <div id="addTaskModal" class="modal-overlay" style="display:none;">
        <div class="modal-box">
            <h3>Add Quick Task</h3>
            <input type="text" id="newTaskName" placeholder="Medicine Name" style="width:100%; padding:10px; margin:5px 0; background:#1a1a2e; border:1px solid #4a5568; color:white;">
            <input type="time" id="newTaskTime" value="09:00" style="width:100%; padding:10px; margin:5px 0; background:#1a1a2e; border:1px solid #4a5568; color:white;">
            <select id="newTaskPatient" style="width:100%; padding:10px; margin:5px 0; background:#1a1a2e; border:1px solid #4a5568; color:white;">
                {% for patient in user.patients %}
                <option value="{{ patient.id }}">{{ patient.name }}</option>
                {% endfor %}
            </select>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button onclick="submitNewTask()" style="flex:1; background:#48bb78; border:none; padding:10px; color:white; border-radius:4px; cursor:pointer;">Save</button>
                <button onclick="document.getElementById('addTaskModal').style.display='none'" style="flex:1; background:#f56565; border:none; padding:10px; color:white; border-radius:4px; cursor:pointer;">Cancel</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>